<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodev</title>
    <style>
        *{
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body{
            background-color: #DDDDDC;
        }
        header{
            min-height: 70px;

            padding: 15px 30px;
            margin: 10px;
            border-radius: 20px;
            
            background-image: linear-gradient(to bottom, #F0F0F0 , #DDDDDC);
        }
        main{
            padding: 20px 30px;
            margin: 10px;
            border-radius: 20px;
            background-image: linear-gradient(to bottom, #F0F0F0 , #DDDDDC);
        }
        nav{
            display: flex;
            flex-direction: column;
            row-gap: 10px;

            padding: 20px 30px;
        }
        .orderCard{
            display: flex;

            max-height: 100px;

            background-color: #F0F0F0;
            border-radius: 25px;
        }
        .orderCard .orderStatus{
            display: block;
            min-height: 100%;
            min-width: auto;
        }
        .orderCard .customerInfos{
            padding: 20px;
        }
        .orderCard .customerLinks{
            display: flex;
            flex-direction: column;

            max-height: 100%;
        }
        .orderCard .customerLinks img{
            display: block;
            width: 100%;
            height: auto;
        }
        footer{
            position: absolute;
            bottom: 0;

            width: calc(100% - 20px);

            min-height: 70px;

            padding: 15px 30px;
            margin: 10px;
            border-radius: 20px;

            background-image: linear-gradient(to top, #F0F0F0 , #DDDDDC);
        }
    </style>
</head>
<body>
    <header>
        <h1>Foodev</h1>
    </header>
    <main>
    </main>
    <nav></nav>
    <footer>Lorem ipsum sit let amet.</footer>
    <script>
        const orderStatusTable = {
            'em preparo': "https://img.icons8.com/color/64/000000/ok--v1.png"
        }
        
        function appendOrder(order){
            const { customer } = order
            const orderStatusImg = orderStatusTable[order.status]
            const orderId = `orderId-${order._id}`
            const orderCard = `
                <div class="orderCard ${orderId}">
                    <img class="orderStatus" src=${orderStatusImg}/>
                    <div class="customerInfos">
                        <h2 class="customerName">${customer.name}</h2>
                        <h4 class="customerPhone">
                            ${customer.phone}
                        </h4>
                    </div>
                </div>
            `
            document.querySelector('nav').innerHTML += orderCard
        }

        function eventListenerOrder(order){
            const orderId = `orderId-${order._id}`
            document.querySelector(`.${orderId}`).addEventListener('click', event => {
                setMainContent(order)
            })
        }

        function setMainContent(order){
            if(!order){
                return document.querySelector('main').innerHTML = ''
            }
            const { customer } = order
            const orderStatusImg = orderStatusTable[order.status]
            const orderId = `orderId-${order._id}`

            const orderBox = `
                <div class="orderBox">
                    <img class="orderStatus" src=${orderStatusImg}/>
                    <div class="customerInfos">
                        <h2 class="customerName">${customer.name}</h2>
                        <h4 class="customerPhone">
                            ${customer.phone}
                        </h4>
                    </div>
                    <div class="customerLinks">
                        <a href="tel:">
                            <img src="https://img.icons8.com/ios-filled/50/000000/apple-phone.png"/>
                        </a>
                        <a href="https://api.whatsapp.com/send?phone=55${customer.phone}&text=Seu%20pedido%20chegou.">
                            <img src="https://img.icons8.com/ios-glyphs/60/000000/whatsapp.png"/>
                        </a>
                    </div>
                </div>
            `
            document.querySelector('main').innerHTML = orderBox
        }

        document.addEventListener("DOMContentLoaded", async event => {
            const response = await fetch('/api/orders', {
                method: 'GET'
            })
            const orders = await response.json()
            console.log(orders)
            orders.forEach(appendOrder)
            orders.forEach(eventListenerOrder)
        })
    </script>
</body>
</html>